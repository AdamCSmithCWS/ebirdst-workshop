<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Lesson 2 Site Selection | eBird Status Data Products Workshop</title>
  <meta name="description" content="Lessons for a workshop on accessing and using the eBird Status Data Products" />
  <meta name="generator" content="bookdown 0.22.15 and GitBook 2.6.7" />

  <meta property="og:title" content="Lesson 2 Site Selection | eBird Status Data Products Workshop" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Lessons for a workshop on accessing and using the eBird Status Data Products" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Lesson 2 Site Selection | eBird Status Data Products Workshop" />
  
  <meta name="twitter:description" content="Lessons for a workshop on accessing and using the eBird Status Data Products" />
  

<meta name="author" content="Matt Strimas-Mackey and Tom Auer" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="access.html"/>
<link rel="next" href="trajectories.html"/>
<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">eBird Status and Trends</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#setup"><i class="fa fa-check"></i><b>0.1</b> Setup</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="access.html"><a href="access.html"><i class="fa fa-check"></i><b>1</b> Data Access</a>
<ul>
<li class="chapter" data-level="1.1" data-path="access.html"><a href="access.html#access-objective"><i class="fa fa-check"></i><b>1.1</b> Objective</a></li>
<li class="chapter" data-level="1.2" data-path="access.html"><a href="access.html#access-intro"><i class="fa fa-check"></i><b>1.2</b> Introduction</a></li>
<li class="chapter" data-level="1.3" data-path="access.html"><a href="access.html#access-request"><i class="fa fa-check"></i><b>1.3</b> Request access</a></li>
<li class="chapter" data-level="1.4" data-path="access.html"><a href="access.html#access-species"><i class="fa fa-check"></i><b>1.4</b> Species list</a></li>
<li class="chapter" data-level="1.5" data-path="access.html"><a href="access.html#access-dl"><i class="fa fa-check"></i><b>1.5</b> Download data</a></li>
<li class="chapter" data-level="1.6" data-path="access.html"><a href="access.html#access-load"><i class="fa fa-check"></i><b>1.6</b> Load data</a></li>
<li class="chapter" data-level="1.7" data-path="access.html"><a href="access.html#access-map"><i class="fa fa-check"></i><b>1.7</b> Mapping</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="site.html"><a href="site.html"><i class="fa fa-check"></i><b>2</b> Site Selection</a>
<ul>
<li class="chapter" data-level="2.1" data-path="site.html"><a href="site.html#site-objective"><i class="fa fa-check"></i><b>2.1</b> Objective</a></li>
<li class="chapter" data-level="2.2" data-path="site.html"><a href="site.html#site-intro"><i class="fa fa-check"></i><b>2.2</b> Introduction</a></li>
<li class="chapter" data-level="2.3" data-path="site.html"><a href="site.html#site-seasonal"><i class="fa fa-check"></i><b>2.3</b> Seasonal abundance data</a></li>
<li class="chapter" data-level="2.4" data-path="site.html"><a href="site.html#site-rangewide"><i class="fa fa-check"></i><b>2.4</b> Range-wide site selection</a></li>
<li class="chapter" data-level="2.5" data-path="site.html"><a href="site.html#site-local"><i class="fa fa-check"></i><b>2.5</b> Local Selection</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="site.html"><a href="site.html#site-local-uncertainty"><i class="fa fa-check"></i><b>2.5.1</b> Uncertainty analysis</a></li>
<li class="chapter" data-level="2.5.2" data-path="site.html"><a href="site.html#site-local-ground"><i class="fa fa-check"></i><b>2.5.2</b> Ground truth</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="trajectories.html"><a href="trajectories.html"><i class="fa fa-check"></i><b>3</b> Multi-species Trajectories</a>
<ul>
<li class="chapter" data-level="3.1" data-path="trajectories.html"><a href="trajectories.html#trajectories-objective"><i class="fa fa-check"></i><b>3.1</b> Objective</a></li>
<li class="chapter" data-level="3.2" data-path="trajectories.html"><a href="trajectories.html#trajectories-intro"><i class="fa fa-check"></i><b>3.2</b> Introduction</a></li>
<li class="chapter" data-level="3.3" data-path="trajectories.html"><a href="trajectories.html#trajectories-data"><i class="fa fa-check"></i><b>3.3</b> Multi-species data</a></li>
<li class="chapter" data-level="3.4" data-path="trajectories.html"><a href="trajectories.html#trajectories-pop"><i class="fa fa-check"></i><b>3.4</b> Proportion of population</a></li>
<li class="chapter" data-level="3.5" data-path="trajectories.html"><a href="trajectories.html#trajectories-traj"><i class="fa fa-check"></i><b>3.5</b> Trajectories</a></li>
<li class="chapter" data-level="3.6" data-path="trajectories.html"><a href="trajectories.html#trajectories-rich"><i class="fa fa-check"></i><b>3.6</b> Richness</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="nonraster.html"><a href="nonraster.html"><i class="fa fa-check"></i><b>4</b> Non-raster Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="nonraster.html"><a href="nonraster.html#nonraster-objective"><i class="fa fa-check"></i><b>4.1</b> Objective</a></li>
<li class="chapter" data-level="4.2" data-path="nonraster.html"><a href="nonraster.html#nonraster-intro"><i class="fa fa-check"></i><b>4.2</b> Introduction</a></li>
<li class="chapter" data-level="4.3" data-path="nonraster.html"><a href="nonraster.html#nonraster-effext"><i class="fa fa-check"></i><b>4.3</b> Effective extent</a></li>
<li class="chapter" data-level="4.4" data-path="nonraster.html"><a href="nonraster.html#nonraster-ppms"><i class="fa fa-check"></i><b>4.4</b> Predictive performance metrics</a></li>
<li class="chapter" data-level="4.5" data-path="nonraster.html"><a href="nonraster.html#nonraster-pi"><i class="fa fa-check"></i><b>4.5</b> Predictor importance</a></li>
<li class="chapter" data-level="4.6" data-path="nonraster.html"><a href="nonraster.html#nonraster-pd"><i class="fa fa-check"></i><b>4.6</b> Partial dependance</a></li>
<li class="chapter" data-level="4.7" data-path="nonraster.html"><a href="nonraster.html#nonraster-habitat"><i class="fa fa-check"></i><b>4.7</b> Habitat association</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="aos21.html"><a href="aos21.html"><i class="fa fa-check"></i><b>5</b> AOS 2021</a>
<ul>
<li class="chapter" data-level="5.1" data-path="aos21.html"><a href="aos21.html#aos21-objectives"><i class="fa fa-check"></i><b>5.1</b> Objective</a></li>
<li class="chapter" data-level="5.2" data-path="aos21.html"><a href="aos21.html#aos21-pop"><i class="fa fa-check"></i><b>5.2</b> Percent of population</a></li>
<li class="chapter" data-level="5.3" data-path="aos21.html"><a href="aos21.html#aos21-habitat"><i class="fa fa-check"></i><b>5.3</b> Habitat associations</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">eBird Status Data Products Workshop</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="site" class="section level1" number="2">
<h1><span class="header-section-number">Lesson 2</span> Site Selection</h1>
<div id="site-objective" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Objective</h2>
<p>To use eBird Status Data Products to identify important sites for Loggerhead Shrike during the breeding season at different spatial scales. This is an example of an analysis you might do to prioritize sites for a species, perhaps for conservation or management.</p>
</div>
<div id="site-intro" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Introduction</h2>
<p>In the previous lesson, we saw how to download and load weekly estimates of relative abundance into R for further analysis. In this lesson, we’ll demonstrate one possible use case for these data: identifying sites of high importance for a species of conservation concern. Let’s start by loading the libraries we’ll need for this analysis.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="site.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ebirdst)</span>
<span id="cb16-2"><a href="site.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb16-3"><a href="site.html#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb16-4"><a href="site.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb16-5"><a href="site.html#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb16-6"><a href="site.html#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb16-7"><a href="site.html#cb16-7" aria-hidden="true" tabindex="-1"></a>extract <span class="ot">&lt;-</span> raster<span class="sc">::</span>extract</span></code></pre></div>
</div>
<div id="site-seasonal" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Seasonal abundance data</h2>
<p>For this site selection analysis we’ll be interested in identifying important sites for Loggerhead Shrike during the <strong>breeding</strong> season. In the <a href="access.html#access">previous lesson</a> we worked with weekly estimates of relative abundance and we saw that we can access predefined seasonal boundary dates from the <code>ebirdst_runs</code> data frame.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="site.html#cb17-1" aria-hidden="true" tabindex="-1"></a>logshr_run <span class="ot">&lt;-</span> <span class="fu">filter</span>(ebirdst_runs, common_name <span class="sc">==</span> <span class="st">&quot;Loggerhead Shrike&quot;</span>)</span>
<span id="cb17-2"><a href="site.html#cb17-2" aria-hidden="true" tabindex="-1"></a>start_dt <span class="ot">&lt;-</span> logshr_run<span class="sc">$</span>breeding_start</span>
<span id="cb17-3"><a href="site.html#cb17-3" aria-hidden="true" tabindex="-1"></a>end_dt <span class="ot">&lt;-</span> logshr_run<span class="sc">$</span>breeding_end</span>
<span id="cb17-4"><a href="site.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(start_dt, end_dt)</span>
<span id="cb17-5"><a href="site.html#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2019-05-24&quot; &quot;2019-07-20&quot;</span></span></code></pre></div>
<p>We could subset the weekly relative abundance <code>RasterStack</code> to just the breeding season weeks, then average across the weeks. However, as a shortcut, the data package provides pre-calculated seasonal raster layers, which we can access with <code>load_raster()</code>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="site.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># find the location of the data we downloaded in the previous lesson</span></span>
<span id="cb18-2"><a href="site.html#cb18-2" aria-hidden="true" tabindex="-1"></a>sp_path <span class="ot">&lt;-</span> <span class="fu">get_species_path</span>(<span class="st">&quot;Loggerhead Shrike&quot;</span>)</span>
<span id="cb18-3"><a href="site.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># load the seasonal rasters</span></span>
<span id="cb18-4"><a href="site.html#cb18-4" aria-hidden="true" tabindex="-1"></a>abd <span class="ot">&lt;-</span> <span class="fu">load_raster</span>(sp_path, <span class="st">&quot;abundance_seasonal&quot;</span>)</span>
<span id="cb18-5"><a href="site.html#cb18-5" aria-hidden="true" tabindex="-1"></a>abd</span>
<span id="cb18-6"><a href="site.html#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; class      : RasterStack </span></span>
<span id="cb18-7"><a href="site.html#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; dimensions : 5630, 6957, 39167910, 4  (nrow, ncol, ncell, nlayers)</span></span>
<span id="cb18-8"><a href="site.html#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; resolution : 2963, 2963  (x, y)</span></span>
<span id="cb18-9"><a href="site.html#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; extent     : -2e+07, 597137, -6673060, 1e+07  (xmin, xmax, ymin, ymax)</span></span>
<span id="cb18-10"><a href="site.html#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; crs        : +proj=sinu +lon_0=0 +x_0=0 +y_0=0 +R=6371007.181 +units=m +no_defs </span></span>
<span id="cb18-11"><a href="site.html#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; names      : breeding, postbreeding_migration, nonbreeding, prebreeding_migration</span></span>
<span id="cb18-12"><a href="site.html#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># subset to just the breeding season</span></span>
<span id="cb18-13"><a href="site.html#cb18-13" aria-hidden="true" tabindex="-1"></a>abd_breeding <span class="ot">&lt;-</span> abd[[<span class="st">&quot;breeding&quot;</span>]]</span>
<span id="cb18-14"><a href="site.html#cb18-14" aria-hidden="true" tabindex="-1"></a>abd_breeding</span>
<span id="cb18-15"><a href="site.html#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; class      : RasterLayer </span></span>
<span id="cb18-16"><a href="site.html#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; dimensions : 5630, 6957, 39167910  (nrow, ncol, ncell)</span></span>
<span id="cb18-17"><a href="site.html#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; resolution : 2963, 2963  (x, y)</span></span>
<span id="cb18-18"><a href="site.html#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; extent     : -2e+07, 597137, -6673060, 1e+07  (xmin, xmax, ymin, ymax)</span></span>
<span id="cb18-19"><a href="site.html#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; crs        : +proj=sinu +lon_0=0 +x_0=0 +y_0=0 +R=6371007.181 +units=m +no_defs </span></span>
<span id="cb18-20"><a href="site.html#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; source     : logshr-ERD2019-STATUS-20201005-c29ce152_hr_2019_abundance-seasonal_breeding.tif </span></span>
<span id="cb18-21"><a href="site.html#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; names      : breeding</span></span></code></pre></div>
<p>This layer represents the expected relative abundance of Loggerhead Shrike during the breeding season on an eBird Traveling Count by a skilled eBirder starting at the optimal time of day with the optimal search duration and distance that maximizes detection of this species in a region.</p>
<p>Let’s crop and re-project based on the species specific map parameters.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="site.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load mapping parameters</span></span>
<span id="cb19-2"><a href="site.html#cb19-2" aria-hidden="true" tabindex="-1"></a>map_pars <span class="ot">&lt;-</span> <span class="fu">load_fac_map_parameters</span>(sp_path)</span>
<span id="cb19-3"><a href="site.html#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="site.html#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># crop and reproject abundance raster</span></span>
<span id="cb19-5"><a href="site.html#cb19-5" aria-hidden="true" tabindex="-1"></a>abd_breeding_proj <span class="ot">&lt;-</span> abd_breeding <span class="sc">%&gt;%</span> </span>
<span id="cb19-6"><a href="site.html#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop</span>(map_pars<span class="sc">$</span>fa_extent_sinu) <span class="sc">%&gt;%</span> </span>
<span id="cb19-7"><a href="site.html#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">projectRaster</span>(<span class="at">crs =</span> map_pars<span class="sc">$</span>custom_projection, <span class="at">method =</span> <span class="st">&quot;ngb&quot;</span>)</span></code></pre></div>
</div>
<div id="site-rangewide" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Range-wide site selection</h2>
<p>To perform a range-wide site selection, we’ll identify the locations with the top 5% of non-zero abundance values across the entire range and visualize those locations.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="site.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove zeroes prior to calculating quantiles</span></span>
<span id="cb20-2"><a href="site.html#cb20-2" aria-hidden="true" tabindex="-1"></a>abd_breeding_proj[abd_breeding_proj <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb20-3"><a href="site.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the 95th quantile</span></span>
<span id="cb20-4"><a href="site.html#cb20-4" aria-hidden="true" tabindex="-1"></a>q95 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(abd_breeding_proj, <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">probs =</span> <span class="fl">0.95</span>)</span>
<span id="cb20-5"><a href="site.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># identify top 5% of cells</span></span>
<span id="cb20-6"><a href="site.html#cb20-6" aria-hidden="true" tabindex="-1"></a>abd_top5 <span class="ot">&lt;-</span> <span class="fu">trim</span>(abd_breeding_proj <span class="sc">&gt;=</span> q95)</span></code></pre></div>
<p>Finally let’s map these selected sites.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="site.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb21-2"><a href="site.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(abd_top5, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&#39;#d9d9d9&#39;</span>, <span class="st">&#39;#fd8d3c&#39;</span>), </span>
<span id="cb21-3"><a href="site.html#cb21-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">axes =</span> <span class="cn">FALSE</span>, <span class="at">box =</span> <span class="cn">FALSE</span>,</span>
<span id="cb21-4"><a href="site.html#cb21-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">maxpixels =</span> <span class="fu">ncell</span>(abd_top5))</span></code></pre></div>
<p><img src="ebirdst-workshop_files/figure-html/rangewide-map-1.png" width="\textwidth" style="display: block; margin: auto;" /></p>
</div>
<div id="site-local" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Local Selection</h2>
<p>Let’s transition from broad-scale, region-wide site selection to a local site selection exercise. For example, let’s consider a land trust working in Louisiana trying to identify important sites for Loggerhead Shrike. To start, we’ll get a boundary polygon for Louisiana.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="site.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get spatial boundary for louisiana</span></span>
<span id="cb22-2"><a href="site.html#cb22-2" aria-hidden="true" tabindex="-1"></a>la <span class="ot">&lt;-</span> <span class="fu">ne_states</span>(<span class="at">iso_a2 =</span> <span class="st">&quot;US&quot;</span>, <span class="at">returnclass =</span> <span class="st">&quot;sf&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="site.html#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;Louisiana&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="site.html#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># project</span></span>
<span id="cb22-5"><a href="site.html#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> map_pars<span class="sc">$</span>custom_projection)</span></code></pre></div>
<p>We can identify the quartiles of the abundance data within Louisiana, essentially dividing the cells within the state into four equally sized groups.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="site.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mask to louisiana</span></span>
<span id="cb23-2"><a href="site.html#cb23-2" aria-hidden="true" tabindex="-1"></a>abd_breeding_la <span class="ot">&lt;-</span> <span class="fu">mask</span>(abd_breeding_proj, la) <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="site.html#cb23-3" aria-hidden="true" tabindex="-1"></a>  raster<span class="sc">::</span><span class="fu">trim</span>()</span>
<span id="cb23-4"><a href="site.html#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="site.html#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate abundance quartiles</span></span>
<span id="cb23-6"><a href="site.html#cb23-6" aria-hidden="true" tabindex="-1"></a>quarters <span class="ot">&lt;-</span> <span class="fu">quantile</span>(abd_breeding_la, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-7"><a href="site.html#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">4</span>)</span>
<span id="cb23-8"><a href="site.html#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="site.html#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># map</span></span>
<span id="cb23-10"><a href="site.html#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb23-11"><a href="site.html#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(la))</span>
<span id="cb23-12"><a href="site.html#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(abd_breeding_la, </span>
<span id="cb23-13"><a href="site.html#cb23-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, quarters), <span class="at">col =</span> <span class="fu">abundance_palette</span>(<span class="dv">4</span>, <span class="at">season =</span> <span class="st">&quot;weekly&quot;</span>),</span>
<span id="cb23-14"><a href="site.html#cb23-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">maxpixels =</span> <span class="fu">ncell</span>(abd_breeding_la),</span>
<span id="cb23-15"><a href="site.html#cb23-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">box =</span> <span class="cn">FALSE</span>, <span class="at">axes =</span> <span class="cn">FALSE</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-16"><a href="site.html#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(la), <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="ebirdst-workshop_files/figure-html/local-quarters-1.png" width="\textwidth" style="display: block; margin: auto;" /></p>
<div id="site-local-uncertainty" class="section level3" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Uncertainty analysis</h3>
<p>When using these abundance rasters at a local scale, it’s important to be cautious because of the broad spatial scale at which the modeling was conducted. As with any modeled estimates, these abundance estimates have uncertainty associated with them. One approach to dealing with this is to use the spatial estimates of uncertainty (the 10th and 90th quantiles of relative abundance) to assess if locations that we’re considering for selection have overlapping confidence intervals.</p>
<p>Let’s start by loading these upper and lower confidence interval raster layers, subsetting to the breeding season within Louisiana, and calculating a breeding season average.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="site.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the upper and lower confidence intervals</span></span>
<span id="cb24-2"><a href="site.html#cb24-2" aria-hidden="true" tabindex="-1"></a>abd_upper <span class="ot">&lt;-</span> <span class="fu">load_raster</span>(sp_path, <span class="st">&quot;abundance_upper&quot;</span>)</span>
<span id="cb24-3"><a href="site.html#cb24-3" aria-hidden="true" tabindex="-1"></a>abd_lower <span class="ot">&lt;-</span> <span class="fu">load_raster</span>(sp_path, <span class="st">&quot;abundance_lower&quot;</span>)</span>
<span id="cb24-4"><a href="site.html#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="site.html#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># subset to breeding season in louisiana</span></span>
<span id="cb24-6"><a href="site.html#cb24-6" aria-hidden="true" tabindex="-1"></a>la_breeding_season <span class="ot">&lt;-</span> <span class="fu">ebirdst_extent</span>(la, <span class="fu">c</span>(start_dt, end_dt))</span>
<span id="cb24-7"><a href="site.html#cb24-7" aria-hidden="true" tabindex="-1"></a>abd_upper_br <span class="ot">&lt;-</span> <span class="fu">ebirdst_subset</span>(abd_upper, la_breeding_season)</span>
<span id="cb24-8"><a href="site.html#cb24-8" aria-hidden="true" tabindex="-1"></a>abd_lower_br <span class="ot">&lt;-</span> <span class="fu">ebirdst_subset</span>(abd_lower, la_breeding_season)</span>
<span id="cb24-9"><a href="site.html#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="site.html#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># average for the breeding season and project</span></span>
<span id="cb24-11"><a href="site.html#cb24-11" aria-hidden="true" tabindex="-1"></a>abd_upper_br_avg <span class="ot">&lt;-</span> <span class="fu">calc</span>(abd_upper_br, <span class="at">fun =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-12"><a href="site.html#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">projectRaster</span>(<span class="at">crs =</span> map_pars<span class="sc">$</span>custom_projection,</span>
<span id="cb24-13"><a href="site.html#cb24-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">&quot;ngb&quot;</span>)</span>
<span id="cb24-14"><a href="site.html#cb24-14" aria-hidden="true" tabindex="-1"></a>abd_lower_br_avg <span class="ot">&lt;-</span> <span class="fu">calc</span>(abd_lower_br, <span class="at">fun =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-15"><a href="site.html#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">projectRaster</span>(<span class="at">crs =</span> map_pars<span class="sc">$</span>custom_projection,</span>
<span id="cb24-16"><a href="site.html#cb24-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">&quot;ngb&quot;</span>)</span></code></pre></div>
<p>Next, let’s imagine we’re considering three potential sites in northern Louisiana, one in each of the top three quartiles of abundance.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="site.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># generate points and convert to spatial</span></span>
<span id="cb25-2"><a href="site.html#cb25-2" aria-hidden="true" tabindex="-1"></a>pts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;High&quot;</span>, <span class="st">&quot;Middle&quot;</span>, <span class="st">&quot;Low&quot;</span>),</span>
<span id="cb25-3"><a href="site.html#cb25-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lng =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">91.173</span>, <span class="sc">-</span><span class="fl">91.137</span>, <span class="sc">-</span><span class="fl">91.169</span>),</span>
<span id="cb25-4"><a href="site.html#cb25-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lat =</span> <span class="fu">c</span>(<span class="fl">32.322</span>, <span class="fl">32.271</span>, <span class="fl">32.295</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-5"><a href="site.html#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;lng&quot;</span>, <span class="st">&quot;lat&quot;</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-6"><a href="site.html#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(map_pars<span class="sc">$</span>custom_projection))</span>
<span id="cb25-7"><a href="site.html#cb25-7" aria-hidden="true" tabindex="-1"></a>pts<span class="sc">$</span>name <span class="ot">&lt;-</span> <span class="fu">factor</span>(pts<span class="sc">$</span>name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;High&quot;</span>, <span class="st">&quot;Middle&quot;</span>, <span class="st">&quot;Low&quot;</span>))</span></code></pre></div>
<p>We can overlay these points on a zoomed-in version of the above quartile map. Note that they each falls within a different colored cell, i.e. they all belong to different quartiles.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="site.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(abd_breeding_la, </span>
<span id="cb26-2"><a href="site.html#cb26-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, quarters), </span>
<span id="cb26-3"><a href="site.html#cb26-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">abundance_palette</span>(<span class="dv">4</span>, <span class="at">season =</span> <span class="st">&quot;weekly&quot;</span>), <span class="at">alpha =</span> <span class="fl">0.75</span>,</span>
<span id="cb26-4"><a href="site.html#cb26-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ext =</span> <span class="fu">st_buffer</span>(pts, <span class="dv">10000</span>), </span>
<span id="cb26-5"><a href="site.html#cb26-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">maxpixels =</span> <span class="fu">ncell</span>(abd_breeding_la),</span>
<span id="cb26-6"><a href="site.html#cb26-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">box =</span> <span class="cn">FALSE</span>, <span class="at">axes =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-7"><a href="site.html#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pts, <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">bg =</span> <span class="st">&quot;red&quot;</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="ebirdst-workshop_files/figure-html/local-uncertainty-map-1.png" width="\textwidth" style="display: block; margin: auto;" /></p>
<p>Let’s look at the abundance and confidence intervals for each of these points.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="site.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract raster values</span></span>
<span id="cb27-2"><a href="site.html#cb27-2" aria-hidden="true" tabindex="-1"></a>pts<span class="sc">$</span>abd <span class="ot">&lt;-</span> <span class="fu">extract</span>(abd_breeding_la, pts)</span>
<span id="cb27-3"><a href="site.html#cb27-3" aria-hidden="true" tabindex="-1"></a>pts<span class="sc">$</span>lower <span class="ot">&lt;-</span> <span class="fu">extract</span>(abd_lower_br_avg, pts)</span>
<span id="cb27-4"><a href="site.html#cb27-4" aria-hidden="true" tabindex="-1"></a>pts<span class="sc">$</span>upper <span class="ot">&lt;-</span> <span class="fu">extract</span>(abd_upper_br_avg, pts)</span>
<span id="cb27-5"><a href="site.html#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="site.html#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the confidence intervals for the three points</span></span>
<span id="cb27-7"><a href="site.html#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pts, <span class="fu">aes</span>(<span class="at">y =</span> abd, <span class="at">x =</span> name)) <span class="sc">+</span></span>
<span id="cb27-8"><a href="site.html#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb27-9"><a href="site.html#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper)) <span class="sc">+</span></span>
<span id="cb27-10"><a href="site.html#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Location&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Relative Abundance&quot;</span>,</span>
<span id="cb27-11"><a href="site.html#cb27-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Confidence intervals for locations&quot;</span>)</span></code></pre></div>
<p><img src="ebirdst-workshop_files/figure-html/local-uncertainty-plot-1.png" width="\textwidth" style="display: block; margin: auto;" /></p>
<p>So, despite the “High” and “Middle” sites belonging to different quartiles of relative abundance, the uncertainty analysis suggests that we don’t have good evidence to pick one site over the other. In contrast, the “Low” site is signficantly lower in relative abundance than the other two sites.</p>
</div>
<div id="site-local-ground" class="section level3" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> Ground truth</h3>
<p>One additional way to check the results of a site selection exercise is to ground truth the results using satellite imagery for the region in question.</p>
<p><img src="img/logshr-satellite.png" width="\textwidth" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="access.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="trajectories.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
