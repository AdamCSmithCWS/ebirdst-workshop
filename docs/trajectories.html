<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Lesson 3 Multi-species Trajectories | eBird Status Data Products Workshop</title>
  <meta name="description" content="Lessons for a workshop on accessing and using the eBird Status Data Products" />
  <meta name="generator" content="bookdown 0.22.15 and GitBook 2.6.7" />

  <meta property="og:title" content="Lesson 3 Multi-species Trajectories | eBird Status Data Products Workshop" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Lessons for a workshop on accessing and using the eBird Status Data Products" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Lesson 3 Multi-species Trajectories | eBird Status Data Products Workshop" />
  
  <meta name="twitter:description" content="Lessons for a workshop on accessing and using the eBird Status Data Products" />
  

<meta name="author" content="Matthew Strimas-Mackey and Tom Auer" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="site.html"/>
<link rel="next" href="nonraster.html"/>
<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">eBird Status and Trends</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#setup"><i class="fa fa-check"></i><b>0.1</b> Setup</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="access.html"><a href="access.html"><i class="fa fa-check"></i><b>1</b> Data Access</a>
<ul>
<li class="chapter" data-level="1.1" data-path="access.html"><a href="access.html#access-objective"><i class="fa fa-check"></i><b>1.1</b> Objective</a></li>
<li class="chapter" data-level="1.2" data-path="access.html"><a href="access.html#access-intro"><i class="fa fa-check"></i><b>1.2</b> Introduction</a></li>
<li class="chapter" data-level="1.3" data-path="access.html"><a href="access.html#access-request"><i class="fa fa-check"></i><b>1.3</b> Request access</a></li>
<li class="chapter" data-level="1.4" data-path="access.html"><a href="access.html#access-species"><i class="fa fa-check"></i><b>1.4</b> Species list</a></li>
<li class="chapter" data-level="1.5" data-path="access.html"><a href="access.html#access-dl"><i class="fa fa-check"></i><b>1.5</b> Download data</a></li>
<li class="chapter" data-level="1.6" data-path="access.html"><a href="access.html#access-load"><i class="fa fa-check"></i><b>1.6</b> Load data</a></li>
<li class="chapter" data-level="1.7" data-path="access.html"><a href="access.html#access-map"><i class="fa fa-check"></i><b>1.7</b> Mapping</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="site.html"><a href="site.html"><i class="fa fa-check"></i><b>2</b> Site Selection</a>
<ul>
<li class="chapter" data-level="2.1" data-path="site.html"><a href="site.html#site-objective"><i class="fa fa-check"></i><b>2.1</b> Objective</a></li>
<li class="chapter" data-level="2.2" data-path="site.html"><a href="site.html#site-intro"><i class="fa fa-check"></i><b>2.2</b> Introduction</a></li>
<li class="chapter" data-level="2.3" data-path="site.html"><a href="site.html#site-seasonal"><i class="fa fa-check"></i><b>2.3</b> Seasonal abundance data</a></li>
<li class="chapter" data-level="2.4" data-path="site.html"><a href="site.html#site-rangewide"><i class="fa fa-check"></i><b>2.4</b> Range-wide site selection</a></li>
<li class="chapter" data-level="2.5" data-path="site.html"><a href="site.html#site-local"><i class="fa fa-check"></i><b>2.5</b> Local Selection</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="site.html"><a href="site.html#site-local-uncertainty"><i class="fa fa-check"></i><b>2.5.1</b> Uncertainty analysis</a></li>
<li class="chapter" data-level="2.5.2" data-path="site.html"><a href="site.html#site-local-ground"><i class="fa fa-check"></i><b>2.5.2</b> Ground truth</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="trajectories.html"><a href="trajectories.html"><i class="fa fa-check"></i><b>3</b> Multi-species Trajectories</a>
<ul>
<li class="chapter" data-level="3.1" data-path="trajectories.html"><a href="trajectories.html#trajectories-objective"><i class="fa fa-check"></i><b>3.1</b> Objective</a></li>
<li class="chapter" data-level="3.2" data-path="trajectories.html"><a href="trajectories.html#trajectories-intro"><i class="fa fa-check"></i><b>3.2</b> Introduction</a></li>
<li class="chapter" data-level="3.3" data-path="trajectories.html"><a href="trajectories.html#trajectories-data"><i class="fa fa-check"></i><b>3.3</b> Multi-species data</a></li>
<li class="chapter" data-level="3.4" data-path="trajectories.html"><a href="trajectories.html#trajectories-pop"><i class="fa fa-check"></i><b>3.4</b> Proportion of population</a></li>
<li class="chapter" data-level="3.5" data-path="trajectories.html"><a href="trajectories.html#trajectories-traj"><i class="fa fa-check"></i><b>3.5</b> Trajectories</a></li>
<li class="chapter" data-level="3.6" data-path="trajectories.html"><a href="trajectories.html#trajectories-rich"><i class="fa fa-check"></i><b>3.6</b> Richness</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="nonraster.html"><a href="nonraster.html"><i class="fa fa-check"></i><b>4</b> Non-raster Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="nonraster.html"><a href="nonraster.html#nonraster-objective"><i class="fa fa-check"></i><b>4.1</b> Objective</a></li>
<li class="chapter" data-level="4.2" data-path="nonraster.html"><a href="nonraster.html#nonraster-intro"><i class="fa fa-check"></i><b>4.2</b> Introduction</a></li>
<li class="chapter" data-level="4.3" data-path="nonraster.html"><a href="nonraster.html#nonraster-effext"><i class="fa fa-check"></i><b>4.3</b> Effective extent</a></li>
<li class="chapter" data-level="4.4" data-path="nonraster.html"><a href="nonraster.html#nonraster-ppms"><i class="fa fa-check"></i><b>4.4</b> Predictive performance metrics</a></li>
<li class="chapter" data-level="4.5" data-path="nonraster.html"><a href="nonraster.html#nonraster-pi"><i class="fa fa-check"></i><b>4.5</b> Predictor importance</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">eBird Status Data Products Workshop</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="trajectories" class="section level1" number="3">
<h1><span class="header-section-number">Lesson 3</span> Multi-species Trajectories</h1>
<div id="trajectories-objective" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Objective</h2>
<p>To prepare data for comparing Status and Trends results across multiple species. As an example, we’ll compute proportion of population trajectories for a suite of species.</p>
</div>
<div id="trajectories-intro" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Introduction</h2>
<p>Comparing Status Data Products between species requires extra caution because the models give <em>relative</em> rather than absolute abundance. For example, species differ in their detectability, and this may cause differences in relative abundance. To address this, we’ll convert relative abundance to a proportion of population metric for each species by dividing the abundance layer by the total abundance summed across the entire range. For any given cell, this gives the proportion of relative abundance occurring in that cell. In addition, in this lesson we’ll look at the temporal dimension of these data, plotting trajectories through time for a given region.</p>
<p>Let’s start by loading the necessary packages for this lesson.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="trajectories.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ebirdst)</span>
<span id="cb28-2"><a href="trajectories.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb28-3"><a href="trajectories.html#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb28-4"><a href="trajectories.html#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb28-5"><a href="trajectories.html#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb28-6"><a href="trajectories.html#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb28-7"><a href="trajectories.html#cb28-7" aria-hidden="true" tabindex="-1"></a>extract <span class="ot">&lt;-</span> raster<span class="sc">::</span>extract</span></code></pre></div>
<p>For this example, we’ll be looking at a suite of shorebird species in Kansas, so let’s also get a boundary polygon for that state.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="trajectories.html#cb29-1" aria-hidden="true" tabindex="-1"></a>ks <span class="ot">&lt;-</span> <span class="fu">ne_states</span>(<span class="at">iso_a2 =</span> <span class="st">&quot;US&quot;</span>, <span class="at">returnclass =</span> <span class="st">&quot;sf&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="trajectories.html#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;Kansas&quot;</span>)</span></code></pre></div>
</div>
<div id="trajectories-data" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Multi-species data</h2>
<p>We begin by downloading data for a suite of 7 shorebird species that all spend at least a portion of the year within Kansas.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="trajectories.html#cb30-1" aria-hidden="true" tabindex="-1"></a>species <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;American Avocet&quot;</span>, <span class="st">&quot;Snowy Plover&quot;</span>, <span class="st">&quot;Hudsonian Godwit&quot;</span>, </span>
<span id="cb30-2"><a href="trajectories.html#cb30-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Willet&quot;</span>, <span class="st">&quot;Marbled Godwit&quot;</span>, <span class="st">&quot;Sanderling&quot;</span>, </span>
<span id="cb30-3"><a href="trajectories.html#cb30-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Semipalmated Sandpiper&quot;</span>)</span>
<span id="cb30-4"><a href="trajectories.html#cb30-4" aria-hidden="true" tabindex="-1"></a>sp_dirs <span class="ot">&lt;-</span> <span class="fu">map_chr</span>(species, ebirdst_download) <span class="sc">%&gt;%</span> </span>
<span id="cb30-5"><a href="trajectories.html#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(species)</span></code></pre></div>
</div>
<div id="trajectories-pop" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Proportion of population</h2>
<p>Our goal is to produce trajectories comparing the proportion of each species’ population within Kansas for each week of 2019. For each species we need to:</p>
<ol style="list-style-type: decimal">
<li>Calculate the sum of the abundance within Kansas for each week</li>
<li>Calculate the sum of the abundance across the entire range of the species for each week</li>
<li>Calculate the proportion of the population as the ratio of the within Kansas abundance to the total abundance</li>
</ol>
<p>The below function performs these steps for a given species. Iterating over the full set of species at the highest resolution is quite computationally intensive, so to speed things up we’re using the low resolution relative abundance estimates. Note that even at the lower resolution, this will still take a few minutes to run.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="trajectories.html#cb31-1" aria-hidden="true" tabindex="-1"></a>calculate_trajectory <span class="ot">&lt;-</span> <span class="cf">function</span>(x, common_name, region) {</span>
<span id="cb31-2"><a href="trajectories.html#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">names</span>(x))</span>
<span id="cb31-3"><a href="trajectories.html#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># load and crop weekly abundance</span></span>
<span id="cb31-4"><a href="trajectories.html#cb31-4" aria-hidden="true" tabindex="-1"></a>  abd <span class="ot">&lt;-</span> <span class="fu">load_raster</span>(x, <span class="at">product =</span> <span class="st">&quot;abundance&quot;</span>, <span class="at">resolution =</span> <span class="st">&quot;lr&quot;</span>)</span>
<span id="cb31-5"><a href="trajectories.html#cb31-5" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(region, <span class="at">crs =</span> <span class="fu">st_crs</span>(abd))</span>
<span id="cb31-6"><a href="trajectories.html#cb31-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-7"><a href="trajectories.html#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># total abundance within region</span></span>
<span id="cb31-8"><a href="trajectories.html#cb31-8" aria-hidden="true" tabindex="-1"></a>  abd_region <span class="ot">&lt;-</span> abd <span class="sc">%&gt;%</span> </span>
<span id="cb31-9"><a href="trajectories.html#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">crop</span>(r) <span class="sc">%&gt;%</span> </span>
<span id="cb31-10"><a href="trajectories.html#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">extract</span>(r, <span class="at">fun =</span> sum)</span>
<span id="cb31-11"><a href="trajectories.html#cb31-11" aria-hidden="true" tabindex="-1"></a>  abd_region <span class="ot">&lt;-</span> abd_region[<span class="dv">1</span>, , drop <span class="ot">=</span> <span class="cn">TRUE</span>]</span>
<span id="cb31-12"><a href="trajectories.html#cb31-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-13"><a href="trajectories.html#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate total range-wide abundance</span></span>
<span id="cb31-14"><a href="trajectories.html#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (.Platform<span class="sc">$</span>OS.type <span class="sc">==</span> <span class="st">&quot;unix&quot;</span>) {</span>
<span id="cb31-15"><a href="trajectories.html#cb31-15" aria-hidden="true" tabindex="-1"></a>    abd_total <span class="ot">&lt;-</span> <span class="fu">mclapply</span>(<span class="fu">seq.int</span>(<span class="fu">nlayers</span>(abd)),</span>
<span id="cb31-16"><a href="trajectories.html#cb31-16" aria-hidden="true" tabindex="-1"></a>                          <span class="cf">function</span>(i) <span class="fu">cellStats</span>(abd[[i]], sum),</span>
<span id="cb31-17"><a href="trajectories.html#cb31-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">mc.preschedule =</span> <span class="cn">TRUE</span>, <span class="at">mc.set.seed =</span> <span class="cn">TRUE</span>, </span>
<span id="cb31-18"><a href="trajectories.html#cb31-18" aria-hidden="true" tabindex="-1"></a>                          <span class="at">mc.cores =</span> <span class="fu">detectCores</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb31-19"><a href="trajectories.html#cb31-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unlist</span>()</span>
<span id="cb31-20"><a href="trajectories.html#cb31-20" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb31-21"><a href="trajectories.html#cb31-21" aria-hidden="true" tabindex="-1"></a>    abd_total <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq.int</span>(<span class="fu">nlayers</span>(abd)),</span>
<span id="cb31-22"><a href="trajectories.html#cb31-22" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">function</span>(i) <span class="fu">cellStats</span>(abd[[i]], sum)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-23"><a href="trajectories.html#cb31-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unlist</span>()</span>
<span id="cb31-24"><a href="trajectories.html#cb31-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-25"><a href="trajectories.html#cb31-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-26"><a href="trajectories.html#cb31-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-27"><a href="trajectories.html#cb31-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">common_name =</span> common_name,</span>
<span id="cb31-28"><a href="trajectories.html#cb31-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">date =</span> <span class="fu">parse_raster_dates</span>(abd),</span>
<span id="cb31-29"><a href="trajectories.html#cb31-29" aria-hidden="true" tabindex="-1"></a>             <span class="at">prop_pop =</span> abd_region <span class="sc">/</span> abd_total,</span>
<span id="cb31-30"><a href="trajectories.html#cb31-30" aria-hidden="true" tabindex="-1"></a>             <span class="at">row.names =</span> <span class="cn">NULL</span>)</span>
<span id="cb31-31"><a href="trajectories.html#cb31-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-32"><a href="trajectories.html#cb31-32" aria-hidden="true" tabindex="-1"></a>trajectories <span class="ot">&lt;-</span> <span class="fu">map2_dfr</span>(sp_dirs, <span class="fu">names</span>(sp_dirs), </span>
<span id="cb31-33"><a href="trajectories.html#cb31-33" aria-hidden="true" tabindex="-1"></a>                         calculate_trajectory,</span>
<span id="cb31-34"><a href="trajectories.html#cb31-34" aria-hidden="true" tabindex="-1"></a>                         <span class="at">region =</span> ks)</span>
<span id="cb31-35"><a href="trajectories.html#cb31-35" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(trajectories,  <span class="st">&quot;data/shorebird_pop-trajectories.csv&quot;</span>)</span></code></pre></div>
</div>
<div id="trajectories-traj" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Trajectories</h2>
<p>Now we can plot these trajectories for the set of shorebird species.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="trajectories.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(trajectories, <span class="fu">aes</span>(date, prop_pop, <span class="at">color =</span> common_name)) <span class="sc">+</span></span>
<span id="cb32-2"><a href="trajectories.html#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb32-3"><a href="trajectories.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Week&quot;</span>, </span>
<span id="cb32-4"><a href="trajectories.html#cb32-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Proportion of Population in Kansas&quot;</span>,</span>
<span id="cb32-5"><a href="trajectories.html#cb32-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb32-6"><a href="trajectories.html#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="naoc2020-ebirdst_files/figure-html/trajectories-traj-1.png" width="\textwidth" style="display: block; margin: auto;" /></p>
</div>
<div id="trajectories-rich" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> Richness</h2>
<p>Finally, we can combine these 7 trajectories into a single trajectory giving an estimate of the richness of this group of shorebirds throughout the year.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="trajectories.html#cb33-1" aria-hidden="true" tabindex="-1"></a>richness <span class="ot">&lt;-</span> trajectories <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="trajectories.html#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="trajectories.html#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_species =</span> <span class="fu">n_distinct</span>(common_name[prop_pop <span class="sc">!=</span> <span class="dv">0</span>]))</span>
<span id="cb33-4"><a href="trajectories.html#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="trajectories.html#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot richness</span></span>
<span id="cb33-6"><a href="trajectories.html#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(richness, <span class="fu">aes</span>(date, n_species)) <span class="sc">+</span></span>
<span id="cb33-7"><a href="trajectories.html#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb33-8"><a href="trajectories.html#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Week&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Richness&quot;</span>)</span></code></pre></div>
<p><img src="naoc2020-ebirdst_files/figure-html/trajectories-rich-1.png" width="\textwidth" style="display: block; margin: auto;" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="site.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="nonraster.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
